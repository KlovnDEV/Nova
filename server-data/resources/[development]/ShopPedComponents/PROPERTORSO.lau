local _testKey = 38 -- replace with the key you want to test the script (fivem keys: https://docs.fivem.net/docs/game-references/controls/)

local good_indices = {
["0"] = {0, 85, 151},
["100"] = {1, 16, 72, 83, 100, 160},
["101"] = {1, 4, 14, 16, 28, 72, 83, 88, 96, 100, 139},
["102"] = {16},
["103"] = {1, 4, 14, 16, 28, 60, 72, 83, 96, 100, 108, 154, 165},
["104"] = {4, 16, 100},
["105"] = {0, 5, 19, 54, 63, 76, 101, 119},
["106"] = {1, 14, 16, 28, 83, 100, 108},
["107"] = {1, 16, 100},
["108"] = {1, 14, 28, 100},
["109"] = {2, 5, 15, 29, 54, 65, 76, 95, 101, 112, 126, 136, 149, 153},
["10"] = {4, 16, 77, 100},
["110"] = {1, 17, 100},
["112"] = {1, 14, 16, 50, 144},
["113"] = {1, 96},
["118"] = {61},
["11"] = {2, 15, 21, 29, 56, 65, 73, 76, 87, 101, 113, 115, 122, 128, 133, 137, 142, 149, 155},
["120"] = {148, 149, 153, 161},
["121"] = {1, 165},
["122"] = {1, 14, 90, 147},
["123"] = {0, 151},
["124"] = {1, 80, 141},
["125"] = {1},
["126"] = {1},
["127"] = {14, 16, 44, 77, 94, 100, 139, 147, 165},
["128"] = {0, 2, 11},
["129"] = {0},
["12"] = {1, 100},
["130"] = {14, 100, 108, 160, 165},
["131"] = {0, 63, 151},
["132"] = {0, 63, 151},
["133"] = {11, 92},
["135"] = {0, 2, 5, 11, 19, 81, 87, 101, 112, 119},
["136"] = {1, 14, 16, 61, 91, 160, 165},
["137"] = {2, 5, 15, 21, 29, 51, 73, 76, 95, 101, 112, 133, 142, 162},
["138"] = {165},
["139"] = {166},
["140"] = {14, 93, 160},
["141"] = {1, 16},
["142"] = {1, 14, 16},
["143"] = {0, 1, 16},
["144"] = {1},
["145"] = {1, 14, 33, 100},
["146"] = {0, 19, 63, 151},
["148"] = {1, 16, 100, 166},
["149"] = {0, 1, 16, 67, 100, 120},
["150"] = {0, 16, 134},
["151"] = {0, 14, 16, 28, 83, 100},
["152"] = {0, 1, 16, 63, 100, 165},
["153"] = {0, 100},
["154"] = {1, 16},
["155"] = {0, 1, 16, 67, 120},
["156"] = {1, 14, 16, 72, 75, 83, 88, 100, 110},
["157"] = {2, 5, 15, 21, 29, 56, 62, 65, 73, 78, 84, 89, 101, 109, 112, 113, 119, 122, 128, 129, 136, 142, 148, 149, 161, 163},
["158"] = {2, 15, 21, 65, 84, 101, 112, 116, 128, 140, 153},
["159"] = {45, 51, 54, 73, 78, 84, 95, 101, 103, 112, 113, 115, 128, 133, 140, 142, 149, 153, 161},
["160"] = {2, 5, 15, 21, 29, 34, 65, 73, 76, 84, 87, 101, 109, 112, 114, 115, 119, 122, 128, 129, 136, 140, 142, 148, 149, 161, 162},
["161"] = {1, 100},
["162"] = {2, 15, 54, 65, 78, 95, 101, 112, 126, 148, 162},
["163"] = {14, 28, 108, 147, 166},
["164"] = {0, 19, 74, 85},
["167"] = {98, 137, 147, 161},
["169"] = {14, 16, 72, 100},
["170"] = {2, 5, 15, 21, 29, 45, 65, 73, 76, 84, 87, 95, 101, 109, 112, 113, 115, 119, 122, 126, 132, 133, 136, 140, 142, 148, 149, 161, 163},
["171"] = {100},
["172"] = {1, 14, 16, 28, 72, 100},
["173"] = {2, 5, 15, 21, 29, 56, 65, 73, 76, 84, 89, 95, 101, 109, 112, 113, 115, 119, 122, 126, 132, 136, 140, 142, 148, 149, 161, 163},
["174"] = {1, 100},
["175"] = {2, 15, 21, 62, 65, 78, 95, 101, 112, 118, 128, 134, 140, 153, 164},
["176"] = {2, 15, 29, 32, 65, 73, 76, 95, 101, 109, 112, 113, 115, 119, 122, 128, 134, 136, 140, 142, 149, 163},
["177"] = {15, 65, 78, 89, 101, 112, 115, 119, 136, 153},
["178"] = {1, 100, 110, 111, 166},
["179"] = {2, 5, 15, 23, 29, 65, 73, 76, 84, 87, 95, 101, 109, 112, 113, 114, 115, 119, 122, 126, 129, 134, 136, 140, 142, 148, 149, 155, 161, 163},
["180"] = {2, 15, 29, 65, 76, 95, 101, 112, 115, 126, 136, 140, 153},
["181"] = {0, 1, 14, 16, 82, 83, 100},
["182"] = {98, 154},
["183"] = {16, 33, 88, 96, 100, 141, 160, 165},
["184"] = {0, 1, 100},
["185"] = {0, 4, 5, 15, 16, 18, 23, 29, 30, 67, 69, 73, 88, 90, 96, 97, 108, 112, 113, 114, 115, 121, 123, 129, 137, 146, 147, 151, 166},
["186"] = {1, 110},
["187"] = {100},
["188"] = {0, 1, 11, 16, 63, 100},
["189"] = {0, 1, 4, 14, 16, 18, 30, 56, 62, 63, 72, 74, 83, 85, 91, 94, 96, 97, 100, 108, 112, 113, 114, 119, 122, 126, 133, 136, 139, 156, 160, 166},
["190"] = {1, 100, 111, 141, 143, 144, 165, 166},
["191"] = {0, 1, 14, 16, 23, 28, 63, 72, 78, 83, 88, 95, 112, 114, 115, 127, 165},
["192"] = {1, 14, 16, 77, 165},
["193"] = {0, 2, 19, 37, 62, 63, 65, 74, 76, 87, 101, 112, 115, 119, 128, 136, 140, 151, 153},
["194"] = {0, 1, 4, 16, 63, 100, 111, 122, 165, 166},
["195"] = {0, 1, 11, 16, 63, 100, 111, 166},
["196"] = {1, 16, 100},
["197"] = {1, 100, 165},
["198"] = {1, 4, 16, 63},
["199"] = {16, 63},
["1"] = {0},
["200"] = {1, 16, 100},
["201"] = {3, 16, 96, 110, 111, 165, 166, 167},
["202"] = {2, 15, 21, 62, 65, 95, 112, 119, 142, 162},
["203"] = {1, 3, 4, 16, 100, 110, 166},
["204"] = {1, 16, 166},
["205"] = {15, 21, 65, 84, 112, 119, 142},
["206"] = {2, 5, 15, 21, 40, 54, 65, 84, 87, 112, 115, 119, 136, 149, 153},
["207"] = {2, 5, 15, 21, 34, 45, 62, 65, 84, 95, 101, 112, 115, 119, 137, 142, 153},
["208"] = {0, 19, 63, 74, 151},
["209"] = {0, 1, 4, 16, 63, 165},
["210"] = {0, 1, 4, 16, 63, 100},
["211"] = {0, 4, 16, 63, 100},
["212"] = {0, 1, 4, 5, 14, 16, 17, 23, 28, 30, 34, 40, 42, 57, 61, 63, 69, 72, 74, 80, 83, 85, 87, 89, 94, 96, 97, 100, 108, 110, 112, 113, 114, 115, 120, 122, 123, 126, 129, 136, 138, 140, 142, 149, 151, 160, 163},
["213"] = {2, 5, 21, 40, 65, 84, 95, 101, 112, 115, 133, 142, 162},
["214"] = {0, 1, 16},
["215"] = {1, 4, 14, 16, 28, 72, 75, 83, 100, 108},
["216"] = {2, 5, 15, 21, 29, 32, 45, 51, 62, 65, 67, 73, 76, 78, 84, 87, 95, 101, 109, 112, 113, 119, 122, 128, 133, 136, 142, 148, 149, 155, 162},
["217"] = {1, 100},
["218"] = {96},
["219"] = {43},
["223"] = {2, 15, 87, 101, 112, 134, 153},
["225"] = {144, 167},
["226"] = {0},
["228"] = {1},
["229"] = {57, 100, 165},
["230"] = {14, 55, 83, 160},
["231"] = {1, 147, 165},
["232"] = {0, 50, 85, 165},
["233"] = {0, 28, 50, 72},
["234"] = {11},
["235"] = {0, 19, 63, 151},
["236"] = {0, 19, 63, 151},
["237"] = {5, 23, 67, 78, 89, 103, 113, 127, 142, 149, 155, 162},
["238"] = {2, 15, 21, 65, 76, 95, 101, 112, 116, 120, 136, 140, 153},
["239"] = {2, 15, 21, 51, 65, 76, 87, 101, 112, 115, 119, 136, 140, 153},
["240"] = {1, 14, 16, 28, 72, 86, 165},
["241"] = {0, 19, 63, 151},
["242"] = {0, 19, 63},
["243"] = {100},
["244"] = {1, 16, 100, 165},
["245"] = {1, 100},
["246"] = {3, 16, 96, 110, 111, 165, 167},
["247"] = {2, 15, 21, 51, 65, 78, 95, 101, 112, 119, 140, 153},
["248"] = {1},
["250"] = {0, 63},
["251"] = {16, 100},
["252"] = {2, 5, 15, 23, 29, 43, 45, 62, 65, 67, 73, 78, 84, 87, 89, 95, 101, 103, 109, 112, 113, 115, 119, 122, 127, 129, 133, 136, 140, 142, 148, 149, 153, 161, 162},
["253"] = {1, 100, 165},
["255"] = {1, 16, 100, 110},
["256"] = {1, 16, 100},
["257"] = {0, 1, 100},
["258"] = {1, 16, 100},
["259"] = {1, 16, 100, 166},
["260"] = {0, 11, 19, 63},
["261"] = {47, 48, 50},
["262"] = {98, 150, 151},
["263"] = {0, 100, 120},
["264"] = {0, 100},
["265"] = {0, 1, 16, 74, 100, 120},
["266"] = {0, 1, 14, 16, 28, 63, 72, 74, 83, 85, 100, 112, 114, 120},
["267"] = {0, 1, 16, 63, 100},
["268"] = {0, 3, 4, 14, 16, 28, 85, 100, 120, 135},
["269"] = {0, 1, 14, 16, 18, 28, 63, 72, 75, 83, 85, 95, 100, 108, 112, 113, 114, 120, 122, 126, 133, 136, 139},
["271"] = {0, 85},
["272"] = {1, 16},
["273"] = {0},
["274"] = {3, 110, 111, 166, 167},
["275"] = {0, 1, 100},
["276"] = {1, 100},
["277"] = {164},
["278"] = {1, 16, 100},
["279"] = {1, 100},
["280"] = {100},
["281"] = {1, 16},
["282"] = {0, 11},
["283"] = {0, 1, 14, 16, 83, 100},
["284"] = {1, 100},
["285"] = {1, 100, 111},
["286"] = {0, 1, 16, 100},
["287"] = {100},
["288"] = {1, 16, 100, 110},
["289"] = {2, 15, 65, 101, 119, 164},
["3"] = {0, 1, 14, 16, 28, 100, 108},
["4"] = {4, 17},
["5"] = {113, 122, 126, 142, 149, 162},
["62"] = {1, 14, 16, 28, 72, 94, 100, 165},
["63"] = {0, 63},
["64"] = {16, 50, 141},
["65"] = {16, 165},
["66"] = {16, 100},
["67"] = {1, 24, 53, 55, 100, 110, 165},
["68"] = {165},
["69"] = {165},
["6"] = {1, 16, 68, 100},
["70"] = {4, 14, 16, 58, 61, 94, 100, 108},
["71"] = {0, 2, 5, 15, 23, 29, 34, 40, 45, 56, 62, 63, 73, 84, 85, 87, 95, 99, 101, 109, 112, 119, 128, 133, 136, 142, 148, 151, 153, 161},
["72"] = {0, 5, 14, 24, 34, 37, 41, 44, 50, 61, 63, 72, 77, 83, 90, 94, 107, 147, 149, 151, 154, 159, 162, 165},
["73"] = {0, 151},
["74"] = {14, 16, 28, 72, 83, 94, 100, 108},
["75"] = {16},
["76"] = {1},
["77"] = {1, 14, 16, 100},
["78"] = {1, 16, 166},
["79"] = {0, 120},
["7"] = {0, 1, 14, 16, 28, 72, 74, 85, 100, 108, 110, 111, 115, 120, 122, 134},
["80"] = {0, 11, 19, 95, 112, 119, 140},
["81"] = {0, 11},
["82"] = {0},
["83"] = {0, 11, 63},
["87"] = {94, 96, 100, 128},
["88"] = {1, 14, 28, 72, 83, 86, 100, 108, 139, 165},
["89"] = {100},
["8"] = {167},
["90"] = {0, 1, 16},
["91"] = {2, 5, 15, 23, 32, 34, 40, 56, 65, 67, 73, 76, 78, 84, 87, 89, 95, 101, 103, 109, 112, 113, 115, 119, 126, 128, 129, 134, 136, 140, 142, 148, 149, 153, 155, 161, 162, 164},
["92"] = {100},
["93"] = {0, 19},
["94"] = {0, 19},
["95"] = {11},
["96"] = {1, 16, 100},
["97"] = {0, 19, 63},
["98"] = {1},
["99"] = {1, 14, 16, 28, 72, 83, 96, 100, 108, 160},
["9"] = {0, 2, 65, 101, 112, 119},
}

Citizen.CreateThread(function()
    while true do
        Citizen.Wait(0)
	SetIkTarget(PlayerPedId(), 1, PlayerPedId(), 0, 0.0, 0.0, 0.6, 0, 100, 100)
    end
end)

function save(fname)
	exports['screenshot-basic']:requestScreenshot(function(data)
--		TriggerEvent('chat:addMessage', { template = '<img src="{0}" style="max-width: 300px;" />', args = { data } })
		TriggerServerEvent('api_test:save', fname, data)
	end)
end

function GetShopPedComponent2(componentHash)
	return Citizen.InvokeNative(0x74C0E2A57EC66760, componentHash, 
		Citizen.PointerValueInt(), 
		Citizen.PointerValueInt(), 
		Citizen.PointerValueInt(), 
		Citizen.PointerValueInt(), 
		Citizen.PointerValueInt(),
		Citizen.PointerValueInt(), 
		Citizen.PointerValueInt(), 
		Citizen.PointerValueInt(), 
		Citizen.PointerValueInt(), 
		Citizen.PointerValueInt() -- gxt
)
end


function GetProperTorso(ped, cid, drawable, texture)
    local ped = PlayerPedId()
    local model = GetEntityModel(ped)
    if (model ~= GetHashKey("mp_m_freemode_01") and model ~= GetHashKey("mp_f_freemode_01")) then
        return -1, -1
    end

    local topHash = GetHashNameForComponent(ped, cid, drawable, texture)
    local fcTorsoDrawable = -1
    local fcTorsoTexture = -1

    for i = 0, GetShopPedApparelForcedComponentCount(topHash) do
        fcNameHash, fcEnumValue, fcType = GetForcedComponent(topHash, i)

        if fcType == 3 then
            if (fcNameHash == 0 or fcNameHash == GetHashKey("0")) then
                fcTorsoDrawable = -1 --fcEnumValue
                fcTorsoTexture = -1 --0
            else
                local lockHash, hash, locate, drawable, texture, f_5, componentType, f_7, f_8, gxt = GetShopPedComponent2(fcNameHash)
--		print(json.encode(lockHash))
--		print(json.encode(hash))
--		print(json.encode(locate))
--		print(json.encode(drawable))
--		print(json.encode(texture))
--		print(json.encode(f_5))
--		print(json.encode(componentType))
--		print(json.encode(f_7))
--		print(json.encode(f_8))
--		print(json.encode(gxt))
                fcTorsoDrawable = drawable
                fcTorsoTexture = texture
            end
        end
    end

    return fcTorsoDrawable, fcTorsoTexture
end

Citizen.CreateThread(function()
    while true do
        Citizen.Wait(0)
        if IsControlJustReleased(0, _testKey) then
		local playerPed = PlayerPedId()

		local arms2 = 0

--[[
		for arms = 0,168 do
			if (IsPedComponentVariationValid(playerPed, 3, arms, arms2)) then
				print(arms)
			end
		end
]]--
		CreateSkinCam(vector3(-1.2, 0, 0.4), vector3(0, 0, 270))
		TriggerEvent('dpemotes:emote', 't2')
--		TriggerEvent('dpemotes:emote', 'handsup')
		Citizen.Wait(5000)

		local arms2 = 0
		local torso2 = 0
		local tshirt2 = 0

                local player = PlayerPedId()


--		for torso1, arm_list in pairs(good_indices) do
                for torso1 = 0, GetNumberOfPedDrawableVariations(playerPed, 11) - 1 do
		for tshirt1 = 0, GetNumberOfPedDrawableVariations(playerPed, 8) - 1 do
--		for torso2 = 0, GetNumberOfPedTextureVariations(playerPed, 11, tonumber(torso1)) - 1 do

	                local torsoDrawable, torsoTexture = GetProperTorso(player, torso1, torso2)
			if torsoDrawable ~= -1 and torsoTexture ~= -1 then
				print(torsoDrawable, torsoTexture)
				SetPedComponentVariation(playerPed, 11, tonumber(torso1), torso2, 2)
				SetPedComponentVariation(playerPed, 8, tshirt1, tshirt2, 2)
				SetPedComponentVariation(playerPed, 3, torsoDrawable, torsoTexture, 2)
				Citizen.Wait(100)
			end
--[[
			for _,arms1 in pairs(arm_list) do
				SetPedComponentVariation(playerPed, 11, tonumber(torso1), torso2, 2)
				SetPedComponentVariation(playerPed, 8, tshirt1, tshirt2, 2)
				SetPedComponentVariation(playerPed, 3, arms1, arms2, 2)
				Citizen.Wait(100)
				save(tostring(torso1).."_"..tostring(arms1).."_"..tostring(tshirt1))
				Citizen.Wait(100)
			end
]]--
		end
		end

--[[
                for torso1 = 0, GetNumberOfPedDrawableVariations(playerPed, 11) - 1 do
--		for torso2 = 0, GetNumberOfPedTextureVariations(playerPed, 11, torso1) - 1 do
		for arms1 = 0, GetNumberOfPedDrawableVariations(playerPed, 3) - 1 do
			SetPedComponentVariation(playerPed, 11, torso1, torso2, 2)
			SetPedComponentVariation(playerPed, 3, arms1, arms2, 2)
			Citizen.Wait(100)
--			save(tostring(torso1).."_"..tostring(torso2).."_"..tostring(arms1).."_"..tostring(arms2))
			save(tostring(torso1).."_"..tostring(arms1))
			Citizen.Wait(100)
--		end
		end
		end
]]--
		DeleteSkinCam()

--            TriggerServerEvent('test:apiTest')
        end
    end
end)